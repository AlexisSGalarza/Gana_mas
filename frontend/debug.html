<!DOCTYPE html><!DOCTYPE html>

<html lang="es"><html lang="es">

<head><head>

    <meta charset="UTF-8">    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Debug - Sistema de Finanzas</title>    <title>Debug - Sistema de Finanzas</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.min.js"></script>    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.min.js"></script>

</head></head>

<body class="bg-light"><body class="bg-light">

    <div class="container mt-4">    <div class="container mt-5">

        <div class="row">        <div class="row justify-content-center">

            <div class="col-12">            <div class="col-md-8">

                <div class="card">                <div class="card">

                    <div class="card-header bg-primary text-white">                    <div class="card-header bg-primary text-white">

                        <h4>üîß Debug - Sistema de Finanzas</h4>                        <h5 class="mb-0">ÔøΩ Debug - Sistema de Finanzas</h5>

                    </div>                    </div>

                    <div class="card-body">                    <div class="card-body">

                        <div class="row mb-3">                        <h6>Estado del Sistema:</h6>

                            <div class="col-md-4 mb-2">                        <div id="debugInfo" class="mb-4"></div>

                                <button class="btn btn-info w-100" onclick="testLogin()">Test Login</button>                        

                            </div>                        <div class="row">

                            <div class="col-md-4 mb-2">                            <div class="col-md-6 mb-3">

                                <button class="btn btn-success w-100" onclick="testCategories()">Test Categor√≠as</button>                                <button class="btn btn-info w-100" onclick="testLogin()">

                            </div>                                    üîê Test Login

                            <div class="col-md-4 mb-2">                                </button>

                                <button class="btn btn-warning w-100" onclick="testReports()">Test Reportes</button>                            </div>

                            </div>                            <div class="col-md-6 mb-3">

                        </div>                                <button class="btn btn-success w-100" onclick="testCategories()">

                        <div class="row mb-3">                                    üìÇ Test Categor√≠as

                            <div class="col-12">                                </button>

                                <button class="btn btn-danger w-100" onclick="clearStorage()">Limpiar Datos</button>                            </div>

                            </div>                            <div class="col-md-6 mb-3">

                        </div>                                <button class="btn btn-warning w-100" onclick="testTransactions()">

                        <div id="results" class="bg-light p-3" style="min-height: 300px; font-family: monospace; font-size: 12px;">                                    üí∏ Test Transacciones

                            Haz clic en un bot√≥n para probar el sistema...                                </button>

                        </div>                            </div>

                    </div>                            <div class="col-md-6 mb-3">

                </div>                                <button class="btn btn-danger w-100" onclick="testReports()">

            </div>                                    üìä Test Reportes

        </div>                                </button>

    </div>                            </div>

                            <div class="col-12">

    <script src="js/main.js"></script>                                <button class="btn btn-secondary w-100" onclick="clearStorage()">

    <script>                                    üóëÔ∏è Limpiar Datos

        function log(msg) {                                </button>

            const results = document.getElementById('results');                            </div>

            const time = new Date().toLocaleTimeString();                        </div>

            results.innerHTML += `[${time}] ${msg}<br>`;                        

            results.scrollTop = results.scrollHeight;                        <div class="mt-4">

        }                            <h6>Resultado de Pruebas:</h6>

                            <div id="testResults" class="bg-light p-3" style="min-height: 200px; font-family: monospace; font-size: 12px; overflow-y: auto;">

        function clear() {                                Presiona un bot√≥n para ejecutar pruebas...

            document.getElementById('results').innerHTML = '';                            </div>

        }                        </div>

                    </div>

        function testLogin() {                </div>

            clear();            </div>

            log('üîê Probando sistema de login...');        </div>

                </div>

            try {

                if (!window.AhorrandoGano) {    <script src="js/main.js"></script>

                    log('‚ùå ERROR: Sistema no cargado');    

                    return;    <script>

                }        let testOutput = [];



                const testUser = {        function log(message, type = 'info') {

                    email: 'test@test.com',            const timestamp = new Date().toLocaleTimeString();

                    password: 'test123',            const color = type === 'error' ? 'text-danger' : 

                    name: 'Usuario Test'                         type === 'success' ? 'text-success' : 

                };                         type === 'warning' ? 'text-warning' : 'text-info';

            

                log('Registrando usuario...');            testOutput.push(`<span class="${color}">[${timestamp}] ${message}</span>`);

                const registerResult = window.AhorrandoGano.UserManager.register(testUser);            document.getElementById('testResults').innerHTML = testOutput.join('<br>');

                            document.getElementById('testResults').scrollTop = document.getElementById('testResults').scrollHeight;

                if (registerResult.success) {        }

                    log('‚úÖ Usuario registrado');

                } else {        function clearLog() {

                    log(`‚ö†Ô∏è ${registerResult.error}`);            testOutput = [];

                }            document.getElementById('testResults').innerHTML = 'Pruebas limpiadas...';

        }

                log('Iniciando sesi√≥n...');

                const loginResult = window.AhorrandoGano.UserManager.login({        // Verificar estado del sistema al cargar

                    email: testUser.email,        document.addEventListener('DOMContentLoaded', function() {

                    password: testUser.password            let systemInfo = '';

                });            

            if (window.AhorrandoGano) {

                if (loginResult.success) {                systemInfo += '<span class="text-success">‚úÖ Sistema AhorrandoGano cargado</span><br>';

                    log('‚úÖ Login exitoso');                

                    const user = window.AhorrandoGano.UserManager.getCurrentUser();                if (window.AhorrandoGano.UserManager) {

                    log(`Usuario activo: ${user.email}`);                    systemInfo += '<span class="text-success">‚úÖ UserManager disponible</span><br>';

                } else {                } else {

                    log(`‚ùå Error en login: ${loginResult.error}`);                    systemInfo += '<span class="text-danger">‚ùå UserManager no disponible</span><br>';

                }                }

            } catch (error) {                

                log(`‚ùå Error: ${error.message}`);                if (window.AhorrandoGano.CategoryManager) {

            }                    systemInfo += '<span class="text-success">‚úÖ CategoryManager disponible</span><br>';

        }                } else {

                    systemInfo += '<span class="text-danger">‚ùå CategoryManager no disponible</span><br>';

        function testCategories() {                }

            clear();                

            log('üìÇ Probando categor√≠as...');                if (window.AhorrandoGano.TransactionManager) {

                    systemInfo += '<span class="text-success">‚úÖ TransactionManager disponible</span><br>';

            try {                } else {

                const user = window.AhorrandoGano.UserManager.getCurrentUser();                    systemInfo += '<span class="text-danger">‚ùå TransactionManager no disponible</span><br>';

                if (!user) {                }

                    log('‚ùå No hay usuario logueado');            } else {

                    return;                systemInfo += '<span class="text-danger">‚ùå Sistema AhorrandoGano NO cargado</span><br>';

                }            }

            

                log(`Usuario: ${user.email}`);            document.getElementById('debugInfo').innerHTML = systemInfo;

                        });

                const categories = window.AhorrandoGano.CategoryManager.getUserCategories(user.id);

                log(`Categor√≠as encontradas: ${categories.length}`);        function testLogin() {

            clearLog();

                if (categories.length === 0) {            log('üîê Probando sistema de login...');

                    log('Creando categor√≠as por defecto...');            

                    window.AhorrandoGano.CategoryManager.initDefaultCategories(user.id);            try {

                    const newCategories = window.AhorrandoGano.CategoryManager.getUserCategories(user.id);                // Crear usuario de prueba

                    log(`Categor√≠as creadas: ${newCategories.length}`);                const testUser = {

                }                    email: 'test@example.com',

                    password: 'test123',

                // Probar crear categor√≠a                    name: 'Usuario Test'

                const testCat = {                };

                    name: 'Test ' + Date.now(),                

                    type: 'expense',                log('Registrando usuario de prueba...');

                    color: '#ff0000',                const registerResult = window.AhorrandoGano.UserManager.register(testUser);

                    icon: 'üß™'                

                };                if (registerResult.success) {

                    log('‚úÖ Usuario registrado correctamente', 'success');

                log('Creando categor√≠a de prueba...');                    

                const result = window.AhorrandoGano.CategoryManager.createCategory(testCat);                    log('Iniciando sesi√≥n...');

                                    const loginResult = window.AhorrandoGano.UserManager.login({

                if (result.success) {                        email: testUser.email,

                    log('‚úÖ Categor√≠a creada correctamente');                        password: testUser.password

                                        });

                    // Probar actualizar                    

                    const updateResult = window.AhorrandoGano.CategoryManager.updateCategory(                    if (loginResult.success) {

                        result.category.id,                         log('‚úÖ Login exitoso', 'success');

                        {...testCat, name: 'Updated Test'}                        

                    );                        const currentUser = window.AhorrandoGano.UserManager.getCurrentUser();

                                            if (currentUser) {

                    if (updateResult.success) {                            log(`‚úÖ Usuario activo: ${currentUser.email}`, 'success');

                        log('‚úÖ Categor√≠a actualizada');                        } else {

                    } else {                            log('‚ùå No se pudo obtener usuario actual', 'error');

                        log(`‚ùå Error actualizando: ${updateResult.error}`);                        }

                    }                    } else {

                        log(`‚ùå Error en login: ${loginResult.error}`, 'error');

                    // Probar eliminar                    }

                    const deleteResult = window.AhorrandoGano.CategoryManager.deleteCategory(result.category.id);                } else {

                    if (deleteResult.success) {                    log(`‚ÑπÔ∏è ${registerResult.error}`, 'warning');

                        log('‚úÖ Categor√≠a eliminada');                    

                    } else {                    // Intentar login con usuario existente

                        log(`‚ùå Error eliminando: ${deleteResult.error}`);                    const loginResult = window.AhorrandoGano.UserManager.login({

                    }                        email: testUser.email,

                } else {                        password: testUser.password

                    log(`‚ùå Error creando: ${result.error}`);                    });

                }                    

                    if (loginResult.success) {

            } catch (error) {                        log('‚úÖ Login con usuario existente exitoso', 'success');

                log(`‚ùå Error: ${error.message}`);                    } else {

            }                        log(`‚ùå Error en login: ${loginResult.error}`, 'error');

        }                    }

                }

        function testReports() {            } catch (error) {

            clear();                log(`‚ùå Error en test de login: ${error.message}`, 'error');

            log('üìä Probando reportes...');            }

        }

            try {

                const user = window.AhorrandoGano.UserManager.getCurrentUser();        function testCategories() {

                if (!user) {            clearLog();

                    log('‚ùå No hay usuario logueado');            log('üìÇ Probando sistema de categor√≠as...');

                    return;            

                }            try {

                const user = window.AhorrandoGano.UserManager.getCurrentUser();

                log(`Usuario: ${user.email}`);                if (!user) {

                    log('‚ùå No hay usuario logueado. Ejecuta test de login primero.', 'error');

                const transactions = window.AhorrandoGano.TransactionManager.getUserTransactions(user.id);                    return;

                log(`Transacciones: ${transactions.length}`);                }

                

                const categories = window.AhorrandoGano.CategoryManager.getUserCategories(user.id);                log(`Usuario activo: ${user.email}`);

                log(`Categor√≠as: ${categories.length}`);                

                // Obtener categor√≠as del usuario

                if (transactions.length > 0) {                log('Obteniendo categor√≠as del usuario...');

                    const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);                const categories = window.AhorrandoGano.CategoryManager.getUserCategories(user.id);

                    const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);                log(`‚úÖ Se encontraron ${categories.length} categor√≠as`, 'success');

                                    

                    log(`üí∞ Ingresos: $${income}`);                categories.forEach(cat => {

                    log(`üí∏ Gastos: $${expenses}`);                    log(`  - ${cat.name} (${cat.type}) ${cat.icon}`);

                    log(`üìä Balance: $${income - expenses}`);                });

                } else {                

                    log('No hay transacciones');                // Probar crear nueva categor√≠a

                }                log('Creando nueva categor√≠a de prueba...');

                const newCategory = {

                log('‚úÖ Test de reportes completado');                    name: 'Test Category ' + Date.now(),

                    type: 'expense',

            } catch (error) {                    color: '#ff0000',

                log(`‚ùå Error: ${error.message}`);                    icon: 'üß™'

            }                };

        }                

                const createResult = window.AhorrandoGano.CategoryManager.createCategory(newCategory);

        function clearStorage() {                if (createResult.success) {

            if (confirm('¬øLimpiar todos los datos?')) {                    log('‚úÖ Categor√≠a creada correctamente', 'success');

                localStorage.clear();                    

                clear();                    // Probar actualizar categor√≠a

                log('üóëÔ∏è Datos limpiados');                    const updateResult = window.AhorrandoGano.CategoryManager.updateCategory(

                setTimeout(() => location.reload(), 1000);                        createResult.category.id, 

            }                        { ...newCategory, name: 'Updated Test Category' }

        }                    );

                    

        // Verificar sistema al cargar                    if (updateResult.success) {

        window.addEventListener('load', function() {                        log('‚úÖ Categor√≠a actualizada correctamente', 'success');

            setTimeout(() => {                    } else {

                if (window.AhorrandoGano) {                        log(`‚ùå Error actualizando: ${updateResult.error}`, 'error');

                    log('‚úÖ Sistema cargado correctamente');                    }

                } else {                    

                    log('‚ùå Sistema no pudo cargar');                    // Probar eliminar categor√≠a

                }                    const deleteResult = window.AhorrandoGano.CategoryManager.deleteCategory(createResult.category.id);

            }, 100);                    if (deleteResult.success) {

        });                        log('‚úÖ Categor√≠a eliminada correctamente', 'success');

    </script>                    } else {

</body>                        log(`‚ùå Error eliminando: ${deleteResult.error}`, 'error');

</html>                    }
                } else {
                    log(`‚ùå Error creando categor√≠a: ${createResult.error}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Error en test de categor√≠as: ${error.message}`, 'error');
            }
        }

        function testTransactions() {
            clearLog();
            log('üí∏ Probando sistema de transacciones...');
            
            try {
                const user = window.AhorrandoGano.UserManager.getCurrentUser();
                if (!user) {
                    log('‚ùå No hay usuario logueado. Ejecuta test de login primero.', 'error');
                    return;
                }
                
                // Obtener categor√≠as
                const categories = window.AhorrandoGano.CategoryManager.getUserCategories(user.id);
                if (categories.length === 0) {
                    log('‚ùå No hay categor√≠as. Ejecuta test de categor√≠as primero.', 'error');
                    return;
                }
                
                log(`Usuario: ${user.email}, Categor√≠as disponibles: ${categories.length}`);
                
                // Crear transacci√≥n de prueba
                const testTransaction = {
                    amount: 100,
                    description: 'Transacci√≥n de prueba ' + Date.now(),
                    categoryId: categories[0].id,
                    type: categories[0].type,
                    date: new Date().toISOString()
                };
                
                log('Creando transacci√≥n de prueba...');
                const result = window.AhorrandoGano.TransactionManager.addTransaction(testTransaction);
                
                if (result.success) {
                    log('‚úÖ Transacci√≥n creada correctamente', 'success');
                    
                    // Obtener transacciones del usuario
                    const userTransactions = window.AhorrandoGano.TransactionManager.getUserTransactions(user.id);
                    log(`‚úÖ Total de transacciones: ${userTransactions.length}`, 'success');
                } else {
                    log(`‚ùå Error creando transacci√≥n: ${result.error}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Error en test de transacciones: ${error.message}`, 'error');
            }
        }

        function testReports() {
            clearLog();
            log('ÔøΩ Probando sistema de reportes...');
            
            try {
                const user = window.AhorrandoGano.UserManager.getCurrentUser();
                if (!user) {
                    log('‚ùå No hay usuario logueado. Ejecuta test de login primero.', 'error');
                    return;
                }
                
                log(`Usuario: ${user.email}`);
                
                // Obtener transacciones
                const transactions = window.AhorrandoGano.TransactionManager.getUserTransactions(user.id);
                log(`üìà Transacciones encontradas: ${transactions.length}`);
                
                if (transactions.length > 0) {
                    const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                    const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                    const balance = income - expenses;
                    
                    log(`üí∞ Ingresos totales: $${income.toFixed(2)}`, 'success');
                    log(`üí∏ Gastos totales: $${expenses.toFixed(2)}`, 'warning');
                    log(`üìä Balance: $${balance.toFixed(2)}`, balance >= 0 ? 'success' : 'error');
                } else {
                    log('‚ÑπÔ∏è No hay transacciones para calcular reportes', 'warning');
                }
                
                // Probar categor√≠as
                const categories = window.AhorrandoGano.CategoryManager.getUserCategories(user.id);
                log(`üìÇ Categor√≠as disponibles: ${categories.length}`, 'info');
                
                log('‚úÖ Test de reportes completado', 'success');
                
            } catch (error) {
                log(`‚ùå Error en test de reportes: ${error.message}`, 'error');
            }
        }

        function clearStorage() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los datos?')) {
                localStorage.clear();
                log('üóëÔ∏è Datos limpiados. Recarga la p√°gina.', 'warning');
                setTimeout(() => location.reload(), 2000);
            }
        }
            }
            
            output.innerHTML = html;
        }
        
        function createTestUser() {
            try {
                const testUser = {
                    name: 'Usuario Prueba',
                    email: 'test@test.com',
                    password: '123456'
                };
                
                const result = window.AhorrandoGano.UserManager.register(testUser);
                if (result.success) {
                    // Iniciar sesi√≥n autom√°ticamente
                    window.AhorrandoGano.UserManager.login(testUser.email, testUser.password);
                    
                    document.getElementById('debugOutput').innerHTML += 
                        '<div class="alert alert-success">‚úÖ Usuario de prueba creado y logueado exitosamente</div>';
                    
                    // Ejecutar debug nuevamente
                    setTimeout(runDebug, 500);
                } else {
                    document.getElementById('debugOutput').innerHTML += 
                        `<div class="alert alert-danger">‚ùå Error al crear usuario: ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('debugOutput').innerHTML += 
                    `<div class="alert alert-danger">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
